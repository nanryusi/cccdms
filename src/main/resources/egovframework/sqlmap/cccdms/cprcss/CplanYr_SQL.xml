<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="CplanYrMaster">

    <typeAlias  alias="CplanYrVo" type="egovframework.cccdms.cprcss.domain.CplanYrVo"/>

	<!-- 연간보육계획안 공통코드 호출 -->
	<select id="CplanYrDAO.selectCodeList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        SELECT
            A.schl_cl_cd    AS cl_cd
            ,B.sub_nm       AS cl_nm
            ,A.tch_div_cd   AS div_cd
            ,C.nm           AS div_nm
        FROM tb_teacher A
                 JOIN tb_school B
                      ON A.schl_cd = B.cd
                       AND A.schl_cl_cd = B.sub_cd
                 LEFT OUTER JOIN tb_common C
                      ON A.tch_div_cd = C.cd
        WHERE 1=1
          AND A.id = #id#
          AND A.schl_cd = #school_cd#
          AND A.us_yn = 'Y'
	</select>

    <select id="CplanYrDAO.selectCplanYrCnt" parameterClass="CplanYrVo" resultClass="java.lang.Integer">
		<![CDATA[
        SELECT
            COUNT(*)
        FROM tb_cplan_yr
        WHERE 1=1
          AND schl_cd    = #school_code#
          AND schl_cl_cd = #class_code#
          AND stnd_yr    = #year#
          AND stnd_mn    = #month#
          AND stnd_wk    = #week#
        ]]>
	</select>

    <insert id="CplanYrDAO.insertCplanYr" parameterClass="CplanYrVo">
        INSERT INTO tb_cplan_yr
        (   idx
        ,schl_cd
        ,schl_cl_cd
        ,stnd_yr
        ,stnd_mn
        ,stnd_wk
        ,main_evnt
        ,main_exp
        ,reg_dt
        ,reg_id
        ,upt_dt
        ,upt_id
        ) VALUES
        ( (SELECT IFNULL(MAX(idx)+1, 1) FROM tb_cplan_yr a
            WHERE a.schl_cd = #school_code#
              AND a.stnd_yr = #year#
              AND a.stnd_mn = #month#
              AND a.stnd_wk = #week#
          )
        ,#school_code#
        ,#class_code#
        ,#year#
        ,#month#
        ,#week#
        ,#mainEvent#
        ,#mainExp#
        ,NOW()
        ,#id#
        ,NOW()
        ,#id#
        )
    </insert>

</sqlMap>
